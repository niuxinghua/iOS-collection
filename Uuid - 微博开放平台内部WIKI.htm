<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0032)http://wiki.intra.weibo.com/Uuid -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<meta name="generator" content="MediaWiki 1.16.2">
<link rel="shortcut icon" href="http://wiki.intra.weibo.com/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.intra.weibo.com/opensearch_desc.php" title="微博开放平台内部WIKI (zh-cn)">
<link rel="alternate" type="application/atom+xml" title="微博开放平台内部WIKI的Atom订阅" href="http://wiki.intra.weibo.com/index.php?title=%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9&amp;feed=atom">		<title>Uuid - 微博开放平台内部WIKI</title>
		<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/shared.css" media="screen">
<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/commonPrint.css" media="print">
<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/main.css" media="screen">
<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/index.php">
<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/index(1).php" media="print">
<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/index(2).php">
<link rel="stylesheet" href="./Uuid - 微博开放平台内部WIKI_files/index(3).php">
		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?270"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script>
var skin="cavendish",
stylepath="/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/$1",
wgScriptPath="",
wgScriptExtension=".php",
wgScript="/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.intra.weibo.com",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="Uuid",
wgTitle="Uuid",
wgAction="view",
wgArticleId=2618,
wgIsArticle=true,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="zh-cn",
wgContentLanguage="zh-cn",
wgBreakFrames=false,
wgCurRevisionId=14372,
wgVersion="1.16.2",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="首页",
wgFormattedNamespaces={"-2": "媒体", "-1": "特殊", "0": "", "1": "讨论", "2": "用户", "3": "用户讨论", "4": "微博开放平台内部WIKI", "5": "微博开放平台内部WIKI讨论", "6": "文件", "7": "文件讨论", "8": "MediaWiki", "9": "MediaWiki讨论", "10": "模板", "11": "模板讨论", "12": "帮助", "13": "帮助讨论", "14": "分类", "15": "分类讨论"},
wgNamespaceIds={"媒体": -2, "特殊": -1, "": 0, "讨论": 1, "用户": 2, "用户讨论": 3, "微博开放平台内部wiki": 4, "微博开放平台内部wiki讨论": 5, "文件": 6, "文件讨论": 7, "mediawiki": 8, "mediawiki讨论": 9, "模板": 10, "模板讨论": 11, "帮助": 12, "帮助讨论": 13, "分类": 14, "分类讨论": 15, "对话": 1, "用户对话": 3, "图像": 6, "档案": 6, "image": 6, "image_talk": 7, "图像对话": 7, "图像讨论": 7, "档案对话": 7, "档案讨论": 7, "文件对话": 7, "模板对话": 11, "帮助对话": 13, "分类对话": 15},
wgSiteName="微博开放平台内部WIKI",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script>
		<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/wikibits.js"><!-- wikibits js --></script>
		<!-- Head Scripts -->
<script src="./Uuid - 微博开放平台内部WIKI_files/ajax.js"></script>
<link rel="stylesheet" type="text/css" href="./Uuid - 微博开放平台内部WIKI_files/shCore.css">

<link rel="stylesheet" type="text/css" href="./Uuid - 微博开放平台内部WIKI_files/shThemeEclipse.css">

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shCore.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushBash.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushCpp.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushCSharp.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushCss.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushDelphi.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushDiff.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushGroovy.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushJava.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushJScript.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushPerl.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushPhp.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushPlain.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushPython.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushRuby.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushScala.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushSql.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushVb.js"></script>

<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/shBrushXml.js"></script>

<script type="text/javascript">SyntaxHighlighter.all();</script>

		<script type="text/javascript" src="./Uuid - 微博开放平台内部WIKI_files/index(4).php"><!-- site js --></script>
	</head>

<body class="mediawiki ltr ns-0 ns-subject page-Uuid skin-cavendish">

<div id="internal"></div> <!-- cavendish-mod -->
<div id="container"> <!-- cavendish-mod / default: globalWrapper -->

    <!-- <div id="mozilla-org"><a href="/wiki/Skin:Cavendish">Mozilla Skin</a></div> -->
    
	<div id="header" class="noprint">
		<a name="top" id="contentTop"></a>
		<h1><a href="http://wiki.intra.weibo.com/%E9%A6%96%E9%A1%B5" title="访问首页"></a></h1>

		<ul> <!-- Start of content action buttons -->
            
	         <li id="ca-nstab-main" class="selected"><a href="http://wiki.intra.weibo.com/Uuid" title="查看页面内容 [c]" accesskey="c">页面</a></li>
	         <li id="ca-talk" class="new"><a href="http://wiki.intra.weibo.com/index.php?title=%E8%AE%A8%E8%AE%BA:Uuid&amp;action=edit&amp;redlink=1" title="关于页面正文的讨论 [t]" accesskey="t">讨论</a></li>
	         <li id="ca-viewsource"><a href="http://wiki.intra.weibo.com/index.php?title=Uuid&amp;action=edit" title="此页面已被保护，你可以查看其源代码。 [e]" accesskey="e">查看源代码</a></li>
	         <li id="ca-history"><a href="http://wiki.intra.weibo.com/index.php?title=Uuid&amp;action=history" title="此页面的早前修订版本 [h]" accesskey="h">历史</a></li>		</ul>

		<form action="http://wiki.intra.weibo.com/%E7%89%B9%E6%AE%8A:%E6%90%9C%E7%B4%A2" id="searchform">
			<div>
			<label for="searchInput">搜索</label>
			<input id="searchInput" name="search" type="text" title="搜索该网站 [ctrl-alt-f]" accesskey="f" value="">
			<input type="submit" name="go" class="searchButton" id="searchGoButton" value="进入" title="如果相同的标题存在的话便直接前往该页面">
			<input type="submit" name="fulltext" class="searchButton" id="mw-searchButton" value="搜索" title="搜索该文字的页面">
			</div>
		</form>

	</div> <!-- End header div -->

	<div id="mBody">

	    <!-- Dunno if this is important...? Who cares about IE5 anyways? C'mon, we got Firefox!

	    <script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script> -->

	    <!-- NAVIGATION -->
		<div id="side" class="noprint"> <!-- cavendish-mod / monobook: column-one -->
			<ul id="nav">
				<li><span>个人工具</span>
				    <ul>
			                                    <li id="pt-login"><a href="http://wiki.intra.weibo.com/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=Uuid">登录</a></li>
	                    				    </ul>
				</li>

                <li><span>导航</span>
        <ul>
        	    <li id="n-.E9.A6.96.E9.A1.B5"><a href="http://wiki.intra.weibo.com/%E9%A6%96%E9%A1%B5">首页</a></li>
        	    <li id="n-.E5.BC.80.E6.94.BE.E5.B9.B3.E5.8F.B0.E4.BA.A7.E5.93.81"><a href="http://wiki.intra.weibo.com/Platform">开放平台产品</a></li>
        	    <li id="n-.E5.BC.80.E6.94.BE.E5.B9.B3.E5.8F.B0.E6.8E.A5.E5.8F.A3"><a href="http://wiki.intra.weibo.com/Api">开放平台接口</a></li>
        	    <li id="n-.E5.BC.80.E6.94.BE.E7.AD.96.E7.95.A5.E8.A7.84.E8.8C.83"><a href="http://wiki.intra.weibo.com/Products">开放策略规范</a></li>
        	    <li id="n-.E5.A4.A7.E6.95.B0.E6.8D.AE"><a href="http://wiki.intra.weibo.com/Tech">大数据</a></li>
        	    <li id="n-.E5.B9.B3.E5.8F.B0.E6.9E.B6.E6.9E.84"><a href="http://wiki.intra.weibo.com/Frame">平台架构</a></li>
            </ul>
    </li>
<li><span>帮助</span>
        <ul>
        	    <li id="n-.E5.B8.AE.E5.8A.A9"><a href="http://wiki.intra.weibo.com/%E5%B8%AE%E5%8A%A9:%E7%9B%AE%E5%BD%95">帮助</a></li>
            </ul>
    </li>
<li><span>工具箱</span>
    <ul>
                    <li id="t-whatlinkshere"><a href="http://wiki.intra.weibo.com/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%85%A5%E9%A1%B5%E9%9D%A2/Uuid" title="列出所有与此页相链的页面 [j]" accesskey="j">链入页面</a></li>

        		    <li id="t-recentchangeslinked"><a href="http://wiki.intra.weibo.com/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%87%BA%E6%9B%B4%E6%94%B9/Uuid" title="从此页链出的所有页面的更改 [k]" accesskey="k">链出更改</a></li>
        				<li id="t-specialpages"><a href="http://wiki.intra.weibo.com/%E7%89%B9%E6%AE%8A:%E7%89%B9%E6%AE%8A%E9%A1%B5%E9%9D%A2" title="所有特殊页面列表 [q]" accesskey="q">特殊页面</a></li>
                    <li id="t-print"><a href="http://wiki.intra.weibo.com/index.php?title=Uuid&amp;printable=yes" rel="alternate" title="这个页面的可打印版本 [p]" accesskey="p">可打印版</a></li>            <li id="t-permalink"><a href="http://wiki.intra.weibo.com/index.php?title=Uuid&amp;oldid=14372" title="这个页面修订版本的永久链接">永久链接</a></li>
        	</ul>
</li>
			</ul>
		</div><!-- end of SIDE div -->

        <!-- MAIN CONTENT -->
	    <div id="mainContent"> <!-- cavendish-mod / monobook: column-content -->
            <!-- <a name="top" id="top"></a> -->
            <!-- sitenotice was here -->
            <h1>Uuid</h1>
            <h3 id="siteSub">出自微博开放平台内部WIKI</h3>
            <div id="contentSub"></div>

                                    <div id="jump-to-nav">跳转到： <a href="http://wiki.intra.weibo.com/Uuid#column-one">导航</a>, <a href="http://wiki.intra.weibo.com/Uuid#searchInput">搜索</a></div>            <!-- start content -->
            <table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>目录</h2> <span class="toctoggle">[<a id="togglelink" class="internal" href="javascript:toggleToc()">隐藏</a>]</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="http://wiki.intra.weibo.com/Uuid#.E4.BB.8B.E7.BB.8D"><span class="tocnumber">1</span> <span class="toctext">介绍</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="http://wiki.intra.weibo.com/Uuid#.E5.8A.9F.E8.83.BD"><span class="tocnumber">1.1</span> <span class="toctext">功能</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="http://wiki.intra.weibo.com/Uuid#.E5.8E.9F.E7.90.86"><span class="tocnumber">1.2</span> <span class="toctext">原理</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="http://wiki.intra.weibo.com/Uuid#.E4.BD.BF.E7.94.A8"><span class="tocnumber">2</span> <span class="toctext">使用</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="http://wiki.intra.weibo.com/Uuid#.E7.94.B3.E8.AF.B7"><span class="tocnumber">2.1</span> <span class="toctext">申请</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="http://wiki.intra.weibo.com/Uuid#.E5.AE.89.E8.A3.85.E4.B8.8E.E4.BD.BF.E7.94.A8"><span class="tocnumber">2.2</span> <span class="toctext">安装与使用</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="http://wiki.intra.weibo.com/Uuid#get_uuid.EF.BC.8864.E4.BD.8D.EF.BC.89"><span class="tocnumber">2.3</span> <span class="toctext">get_uuid（64位）</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="http://wiki.intra.weibo.com/Uuid#get_uuid_52bit"><span class="tocnumber">2.4</span> <span class="toctext">get_uuid_52bit</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="http://wiki.intra.weibo.com/Uuid#get_uuid_52bit_20120613"><span class="tocnumber">2.5</span> <span class="toctext">get_uuid_52bit_20120613</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table><script>if (window.showTocToggle) { var tocShowText = "显示"; var tocHideText = "隐藏"; showTocToggle(); } </script>
<h2> <span class="mw-headline" id=".E4.BB.8B.E7.BB.8D">介绍</span></h2>
<h3> <span class="mw-headline" id=".E5.8A.9F.E8.83.BD">功能</span></h3>
<p>生成全局唯一的ID；
</p>
<h3> <span class="mw-headline" id=".E5.8E.9F.E7.90.86">原理</span></h3>
<ul><li> 实现：采用Redis事件驱动机制，嵌入uuid生成模块；
</li><li> 由当前时间、内部计数器、IDC、业务号、HA共同决定唯一得ID。
</li></ul>
<h2> <span class="mw-headline" id=".E4.BD.BF.E7.94.A8">使用</span></h2>
<h3> <span class="mw-headline" id=".E7.94.B3.E8.AF.B7">申请</span></h3>
<ul><li>申请资源及流程联系：关启盼 &lt;qipan@staff.sina.com.cn&gt;  刘栋 &lt;liudong2@staff.sina.com.cn&gt;
</li><li>技术开发联系：刘斌 &lt;liubin8@staff.weibo.com&gt;
</li></ul>
<h3> <span class="mw-headline" id=".E5.AE.89.E8.A3.85.E4.B8.8E.E4.BD.BF.E7.94.A8">安装与使用</span></h3>
<ul><li> 安装参考<a href="http://wiki.intra.weibo.com/Redis" class="external text" rel="nofollow">Redis</a>；
</li><li> 使用Memcached协议解析与发送数据，支持quit、get、stats命令；
</li></ul>
<h3> <span class="mw-headline" id="get_uuid.EF.BC.8864.E4.BD.8D.EF.BC.89">get_uuid（64位）</span></h3>
<pre>计算规则：(unsigned long long)time(NULL) &lt;&lt; 32) + (serverid &lt;&lt; 24) + ++ seqid&nbsp;% (1 &lt;&lt; 24)；
serverid：idc（服务器）编号，可支持256(2^8)组服务器；
seqid：当前服务器内部的计数器，每秒支持1677,7216(2^24)个请求；
最大时间：2106-02-07 06:28:16，by time.gmtime(1&lt;&lt;32)；
</pre>
<h3> <span class="mw-headline" id="get_uuid_52bit">get_uuid_52bit</span></h3>
<pre>计算规则：((unsigned long long)time(NULL) – 515483463 &lt;&lt; 22) + (serverid &lt;&lt; 18) + ++ seqid&nbsp;% (1 &lt;&lt; 18)
515483463为常量，因此支持的起始时间为：1986-05-03 05:51:03 by time.gmtime(515483463)；
serverid：idc（服务器）编号，支持16(2^4)组服务器；
seqid：当前服务器内部计数器，每秒支持26,2144个请求；
最大时间：2020-05-11 19:28:07， by time.gmtime(515483463 + (1&lt;&lt;30))；
</pre>
<h3> <span class="mw-headline" id="get_uuid_52bit_20120613">get_uuid_52bit_20120613</span></h3>
<pre>计算规则：((unsigned long long)time(NULL) – 515483463 &lt;&lt; 22) + (serverid &lt;&lt; 18) + (id &lt;&lt; 16) + (++seqidarray[id]&nbsp;% (1 &lt;&lt; 15) &lt;&lt; 1) + haid；
id为业务id（business id），来自用户请求且0&lt;=id&lt;4；
seqidarray为每个业务下的内部计数器，各业务每秒支持3,2768个请求；
haid为HA设置的主备标记；
其他项参考get_uuid_52bit；
</pre>
<p>Edit by liubin8@staff.weibo.com, date 2014.11.29
</p>
<!-- 
NewPP limit report
Preprocessor node count: 55/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key opentwiki-ow_:pcache:idhash:2618-0!1!0!!zh-cn!2!edit=0 and timestamp 20170118073640 -->
<div class="printfooter">
取自“<a href="http://wiki.intra.weibo.com/Uuid">http://wiki.intra.weibo.com/Uuid</a>”</div>
            <div id="catlinks" class="catlinks catlinks-allhidden"></div>            <!-- end content -->
                        <div class="visualClear"></div>
	    </div> <!-- End mainContent div -->

	</div> <!-- End mBody div -->

	<div class="visualClear"></div>

	<!-- FOOTER -->
    <div id="footer">
                    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="./Uuid - 微博开放平台内部WIKI_files/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki"></a></div>

        
        
	    <ul>
	    		        <li id="lastmod"> 此页面最后修订于2014年11月29日 (星期六) 07:00。</li>
        		        <li id="viewcount">此页面已被浏览过328次。</li>
                </ul>

        		    <ul id="f-list">
            			    <li id="privacy"><a href="http://wiki.intra.weibo.com/%E5%BE%AE%E5%8D%9A%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E5%86%85%E9%83%A8WIKI:%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96" title="微博开放平台内部WIKI:隐私政策">隐私政策</a></li>
            			    <li id="about"><a href="http://wiki.intra.weibo.com/%E5%BE%AE%E5%8D%9A%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E5%86%85%E9%83%A8WIKI:%E5%85%B3%E4%BA%8E" title="微博开放平台内部WIKI:关于">关于微博开放平台内部WIKI</a></li>
            			    <li id="disclaimer"><a href="http://wiki.intra.weibo.com/%E5%BE%AE%E5%8D%9A%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E5%86%85%E9%83%A8WIKI:%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E" title="微博开放平台内部WIKI:免责声明">免责声明</a></li>
                        <li class="noprint"><a href="http://www.mediawiki.org/wiki/Manual:Gallery_of_user_styles#Cavendish_mod">Mozilla Skin</a></li>
		    </ul>
            </div> <!-- End of footer div -->

</div> <!-- End of container div -->


<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.068 secs. -->
</body></html>